# MySQLの基礎(1)

## データベース・ソフトウェアとは

```
？？？「データなんてテキストファイルに保存すればいいじゃん!!」
```

### データベースソフトウェアの必要性

個人の手元で動くアプリケーションならテキストファイルでよいかもしれません（？）
わざわざ文法や使い方を覚えてまでデータベース・ソフトウェアを使う意味はあるのでしょうか。
下記の理由から、MySQLなどのデータベースを使う意味があると言えます。

+ データの一元管理
+ データ同士に関連性を持たせる。
  + 関連性を持ったデータの参照を容易にする
+ データに対する処理の一貫性を保つ

### データベースソフトの種類
+ リレーショナル・データベース
  + MySQLなど
+ オブジェクト指向データベース
  + すまん..よく知らん
+ NoSQLデータベース
  + はやりのkey-valueストアなど。プログラミング言語でいうところのハッシュみたいな奴ら

リレーショナル・データベースモデルは木構造などを扱うのが苦手なので、これらに特化したデータベースソフトも有ります。

### MySQL
世界で最も普及しているオープンソースのデータベースソフト、昔はスウェーデンの会社が管理していたが、
今はオラクルの管理下にある(それに対する懸念を唱える者もいる)、シャア率が高いので、ネット上に様々な言語で
ノウハウが蓄積している。俗に「[寿司ビール問題](http://blog.kamipo.net/entry/2015/03/23/093052)」とか言われる細かい問題は抱えているが、ある程度枯れている技術なので使いやすい。
チューニング次第でははやりのNoSQLデータベースのソフトを用いるよりパフォーマンスが出る(らしい)

## リレーショナルデータベース

```
？？？「リレーショナルって要は表ってことだろ!!エクセルでいいじゃん!!」
？？？「エクセルは最強のソフトだから仕方ないね」
```

### リレーショナルデータモデル
リレーショナル・データモデルでは、データを表(テーブル)として表現します。  
テーブルには列と行があり、各列には名前が付けられています。各行は1つ1つのデータに対応します。
データを表として表現することが前提なので、表として表すのが適さないデータ構造は扱いづらくなります。
テーブル同士の関係性をリレーションといいます

### 主キー（プライマリーキー)
主キーは、端的に言うと、あるテーブルのデータを識別できる列もしくは列の組の事をいいます。
イメージとしては指で指し示せるものといえばよいでしょうか。他人に伝えるときに「これなんだけど」
と指で示して伝わる列のことです。例えば、学生番号と学生の名前が格納されている表があったとして、
学生の名前を指さしても相手方は誤解するかもしれません。なぜなら、同姓同名のは学生がいるかもしれないからです。
反対に、（マトモな大学組織なら)学生番号は各学生にたいして唯一に決まっていますから、学生番号を指し示せば
相手には伝わるわけです。  

以上のことを鑑みて、下記の条件を主キーは満たさなくてはいけません。

+ 一意性がある
+ NULLでない(値はかならずある)

また、ここに「更新されない」という条件を入れることもあります。  
主キーを更新する操作で妙な挙動をデータベースソフトが示すこともあります。

#### NOTE:
Rails使っている時に素のままでscaffoldするとかならずidが主キーになります。これはある意味不便です。
なぜなら、復号主キーを扱いたい場合があるからです。例えば、何らかのゲームで、チームごとに別れてバトルを行うとします。
各チームにはチームのid、各チームメンバーにはメンバーのidがあるとすると

|team_id  |member_id  |last_attacked_at  |
|---|---|---|
|1  |1  |昨日  |
|1  |2  |今日  |
|2  |1  |昨日  |
|2  |2  |今日  |

こんな感じのテーブルを作りたくなるかもしれません（例が適当過ぎますが...あしからず)
この場合、上から連番でidを振っていってもいいですが、データを指し示す & データの特徴を表すって意味では
idにはほとんど意味がありませんね。実際に使うときはidで引くことはないでしょうから。  

ちなみに、
```
gem 'composite_primary_keys'
```
このgemを入れると復号primariy_keyに対応できたりします。

## データベース設計
### テーブル間の関係性
+ 1対1
+ 1対多
+ 多対多

### 正規形

```
？？？「やべえ、あっちこっちのテーブルにプレイヤーのHP保存されてるぞ..」
```

同じデータがあちこちに格納されていると、データの不整合が起こりやすくなります。どれかを修正した時にどれかの修正を忘れると、
同じ意味なのに値が異なるデータが生まれてしまうからです。こういう冗長性をなくすようにする事を正規化といいます。
正規化し過ぎると（パフォーマンス等の観点から)扱いづらくなるので、あえて正規化しないこともあります。  
基本的には正規化して設計するものだと考えてくれれば間違いはないです。